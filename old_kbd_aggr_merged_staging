SELECT 
a.store_id, 
sm.internal_code, 
a.visit_id, 
a.visit_date_key, 
a.categ_name, 
a.owner_id, 
a.seg1, 
a.brand, 
a.own_primary_facing,
a.total_primary_facing, 
a.own_display_facing,
a.total_display_facing, 
a.compliance, 
a.psku_target,
a.psku_weight, 
a.sod_target, 
a.sod_weight, 
a.ps_target,
a.ps_weight,
a.sos_target, 
a.sos_weight, 
a.primary_facing,
a.present_count, 
a.oos_count, 
a.display_facing, 
b.bc_weight, 
b.oc_weight,
b.tzone_weight,
b.bc_target, 
b.oc_target, 
b.tzone_target, 
b.bc_compliance, 
b.oc_compliance, 
b.tzone_compliance, 
a.pv_target, 
a.pv_weight
   FROM procter_and_gamble_es_pharma.kbd_calculations_staging a
   LEFT JOIN procter_and_gamble_es_pharma.allbrands_aggregations_final_staging b ON a.visit_id = b.visit_id AND a.seg1::text = b.seg1::text AND a.brand::text = b.brand::text
   JOIN procter_and_gamble_es_pharma.store_master sm ON a.store_id = sm.store_id;
